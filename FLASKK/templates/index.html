<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小飞日语</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <img src="{{ url_for('static', filename='images/多语言.png') }}" alt="小飞在线--日语单词速记" class="logo">
            <h1 class="tagline">小飞速记日语单词</h1>
        </header>
        <main class="main-content">
            <div class="input-section">
                <input type="text" class="input-box" placeholder="请输入日语单词 用空格分隔">
                <button class="confirm-button" onclick="moveInput()" id="confirm-button">确认</button>
            </div>


            <div class="loading" id="loading" style="display: none;">
                <p>生成中....</p>
                <svg viewBox="0 0 50 50">
                    <circle class="ring" cx="25" cy="25" r="20"></circle>
                    <circle class="ball" cx="25" cy="5" r="3.5"></circle>
                </svg>
            </div>

            <div class="content" id="content" style="display: none;">
                <div id="text-content">
                    这是一些日语文本内容
                    <!-- <img src="./音乐.png" alt="播放音频" class="audio-icon" onclick="toggleAudio()"> -->
                </div>
                <audio id="audio" src=""></audio>
                <div class="download-section">
                    <button onclick="downloadAudio()" id="audio_download">下载音频</button>
                    <button onclick="downloadPDF()">下载PDF</button>
                </div>
            </div>
        </main>
    </div>
    <div id="audio-player" class="audio-player" style="display: none;">
        <div class="icon-container">
            <img src="{{ url_for('static', filename='music.png') }}" alt="播放音频" class="audio-icon" >
        </div>
        <div class="button-container">
            <button onclick="playPauseAudio()">▶️</button>
            <button onclick="forwardAudio()">⏩</button>
            <button onclick="rewindAudio()">⏪</button>
            <button onclick="restartAudio()">🔄</button>
        </div>
    </div>
    
    <script src="scripts.js"></script>
</body>
</html>


<script>
// 移动输入框并显示加载动画
var Isupload = false;
let global_data  = null;


// 从服务器获取内容
async function fetchContent(words) {
    console.log('预计POST的字段是:',words);
    try {
        const response = await fetch('/Gemini', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ words: words })
        });
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        console.log(data);
        global_data = data;
        console.log(data.content);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        document.getElementById('audio-player').style.display = 'block';
        document.getElementById('text-content').innerHTML = data.html_code;
        document.getElementById('audio').src = data.audio_filename;
        document.getElementById('confirm-button').style.display = 'none';
        console.log('audio_filename:',document.getElementById('audio').src);
    } catch (error) {
        console.error('Error:', error);
        alert('获取内容失败，请稍后再试。',error);
    }
}

async function moveInput() {
    var input = document.querySelector('.input-box').value;
    document.getElementById('loading').style.display = 'block';
    if(input == ''){
        alert('请输入日语单词!');
        return;
    }
    if(Isupload){
        alert('请等待上一次生成完成!');
        return;
    }

    const container = document.querySelector('.container');
    container.style.transform = 'translateY(-200px)';
    await fetchContent(input);
    Isupload = true;
}

// 音频播放相关功能
let audio = document.getElementById('audio');
let isPlaying = false;

function toggleAudio() {
    isPlaying ? audio.pause() : audio.play();
    isPlaying = !isPlaying;
}

function playPauseAudio() {
    toggleAudio();
}

function rewindAudio() {
    audio.currentTime -= 5;
}

function forwardAudio() {
    audio.currentTime += 5;
}

function restartAudio() {
    audio.currentTime = 0;
    audio.play();
    isPlaying = true;
}

// 拖拽功能
dragFunc('audio-player'); // 应用拖拽功能到音乐播放器图标和按钮

function dragFunc(id) {
    var Drag = document.getElementById(id);
    Drag.onmousedown = function(event) {
        var ev = event || window.event;
        event.stopPropagation();
        var disX = ev.clientX - Drag.offsetLeft;
        var disY = ev.clientY - Drag.offsetTop;
        document.onmousemove = function(event) {
            var ev = event || window.event;
            Drag.style.left = ev.clientX - disX + "px";
            Drag.style.top = ev.clientY - disY + "px";
            Drag.style.cursor = "move";
        };
    };
    Drag.onmouseup = function() {
        document.onmousemove = null;
        this.style.cursor = "default";
    };
};

// 下载音频
function downloadAudio() {
    const link = document.createElement('a');
    link.href = global_data.audio_filename;
    link.download = '听力材料.mp3';
    link.click();
}

// 下载PDF
function downloadPDF() {
    const link = document.createElement('a');
    link.href = global_data.pdf_filename;
    link.download = 'document.pdf';
    link.click();
}
</script>




<style>
body, html {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #f0f0f0;
    overflow: hidden; /* 防止拖拽时页面滚动 */
}

.container {
    text-align: center;
    transition: transform 0.5s ease-in-out;
    height: 100%; /* 或者其他适当的高度 */
    overflow: auto; /* 当内容溢出时，添加滚动条 */
}

#content{
    justify-content: center; /* 子元素在主轴(水平)上居中对齐 */
    overflow: auto; /* 当内容溢出时，添加滚动条 */
}

.header {
    margin-top: 300px;
    margin-bottom: 20px;
    width: 1000px;
}

.logo {
    width: 100px;
}

.tagline {
    font-size: 24px;
    color: #333;
}

.input-section {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
}

.input-box {
    padding: 10px;
    font-size: 18px;
    border: 2px solid #4CAF50;
    border-radius: 4px;
    width: 70%;
    box-sizing: border-box;
}

.confirm-button {
    margin-left: 10px;
    padding: 10px;
    font-size: 18px;
    color: white;
    background-color: #4CAF50;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.confirm-button:hover {
    background-color: #afcbf0;
}

.loading {
    margin-top: 20px;
    font-size: 18px;
    color: #555;
}

.content {
    margin-top: 20px;
}

#text-content  {
    color: #333;
    margin-left: 13%;
    width: 75%;
    text-align: left; /* 左对齐文本 */
    line-height: 1.0; /* 行高 */
}

#text-content p{
    color: #333;
    font-size: 20px;
    text-align: left; /* 左对齐文本 */
    line-height: 1.0; /* 行高 */
}
#text-content ul li{
    color: #333;
    font-size: 20px;
    text-align: left; /* 左对齐文本 */
    line-height: 1.0; /* 行高 */
}
.audio-icon {
    width: 24px;
    cursor: pointer;
    vertical-align: middle;
    margin-left: 10px;
}

.download-section {
    margin-top: 20px;
}

.download-section button {
    margin: 0 10px;
    padding: 10px;
    font-size: 16px;
    color: white;
    background-color: #4CAF50;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.download-section button:hover {
    background-color: #afcbf0;
}

/* styles.css */

.audio-player {
    position: absolute;
    bottom: 20px;
    left: 20px;
    padding: 10px;
    border: #4CAF50;
    border-radius: 4px;
    cursor: move;
    z-index: 1000;
    display: flex;
    flex-direction: column; /* 将子元素纵向排列 */
    align-items: center;
}

.icon-container {
    margin-bottom: 10px; /* 控制图标与按钮之间的间距 */
}

.audio-icon {
    cursor: pointer;
    vertical-align: middle;
    width: 180px;
}

.button-container {
    display: flex;
    flex-direction: row; /* 将按钮横向排列 */
}

.audio-player button {
    margin: 3px;
    padding: 5px;
    font-size: 30px;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.audio-player button:hover {
    background-color: #afcbf0;
}

svg {
    width: 3.75em;
    animation: 1.5s spin ease infinite;
  }
  
.ring {
    fill: none;
    stroke: hsla(197, 93%, 52%, 0.3);
    stroke-width: 2;
  }
  
.ball {
    fill: #4700ee;
    stroke: none;
  }
  
@keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
</style>