<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é£æ—¥è¯­</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <img src="{{ url_for('static', filename='images/å¤šè¯­è¨€.png') }}" alt="å°é£åœ¨çº¿--æ—¥è¯­å•è¯é€Ÿè®°" class="logo">
            <h1 class="tagline">å°é£é€Ÿè®°æ—¥è¯­å•è¯</h1>
        </header>
        <main class="main-content">
            <div class="input-section">
                <input type="text" class="input-box" placeholder="è¯·è¾“å…¥æ—¥è¯­å•è¯ ç”¨ç©ºæ ¼åˆ†éš”">
                <button class="confirm-button" onclick="moveInput()" id="confirm-button">ç¡®è®¤</button>
            </div>


            <div class="loading" id="loading" style="display: none;">
                <p>ç”Ÿæˆä¸­....</p>
                <svg viewBox="0 0 50 50">
                    <circle class="ring" cx="25" cy="25" r="20"></circle>
                    <circle class="ball" cx="25" cy="5" r="3.5"></circle>
                </svg>
            </div>

            <div class="content" id="content" style="display: none;">
                <div id="text-content">
                    è¿™æ˜¯ä¸€äº›æ—¥è¯­æ–‡æœ¬å†…å®¹
                    <!-- <img src="./éŸ³ä¹.png" alt="æ’­æ”¾éŸ³é¢‘" class="audio-icon" onclick="toggleAudio()"> -->
                </div>
                <audio id="audio" src=""></audio>
                <div class="download-section">
                    <button onclick="downloadAudio()" id="audio_download">ä¸‹è½½éŸ³é¢‘</button>
                    <button onclick="downloadPDF()">ä¸‹è½½PDF</button>
                </div>
            </div>
        </main>
    </div>
    <div id="audio-player" class="audio-player" style="display: none;">
        <div class="icon-container">
            <img src="{{ url_for('static', filename='music.png') }}" alt="æ’­æ”¾éŸ³é¢‘" class="audio-icon" >
        </div>
        <div class="button-container">
            <button onclick="playPauseAudio()">â–¶ï¸</button>
            <button onclick="forwardAudio()">â©</button>
            <button onclick="rewindAudio()">âª</button>
            <button onclick="restartAudio()">ğŸ”„</button>
        </div>
    </div>
    
    <script src="scripts.js"></script>
</body>
</html>


<script>
// ç§»åŠ¨è¾“å…¥æ¡†å¹¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
var Isupload = false;
let global_data  = null;


// ä»æœåŠ¡å™¨è·å–å†…å®¹
async function fetchContent(words) {
    console.log('é¢„è®¡POSTçš„å­—æ®µæ˜¯:',words);
    try {
        const response = await fetch('/Gemini', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ words: words })
        });
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        console.log(data);
        global_data = data;
        console.log(data.content);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        document.getElementById('audio-player').style.display = 'block';
        document.getElementById('text-content').innerHTML = data.html_code;
        document.getElementById('audio').src = data.audio_filename;
        document.getElementById('confirm-button').style.display = 'none';
        console.log('audio_filename:',document.getElementById('audio').src);
    } catch (error) {
        console.error('Error:', error);
        alert('è·å–å†…å®¹å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚',error);
    }
}

async function moveInput() {
    var input = document.querySelector('.input-box').value;
    document.getElementById('loading').style.display = 'block';
    if(input == ''){
        alert('è¯·è¾“å…¥æ—¥è¯­å•è¯!');
        return;
    }
    if(Isupload){
        alert('è¯·ç­‰å¾…ä¸Šä¸€æ¬¡ç”Ÿæˆå®Œæˆ!');
        return;
    }

    const container = document.querySelector('.container');
    container.style.transform = 'translateY(-200px)';
    await fetchContent(input);
    Isupload = true;
}

// éŸ³é¢‘æ’­æ”¾ç›¸å…³åŠŸèƒ½
let audio = document.getElementById('audio');
let isPlaying = false;

function toggleAudio() {
    isPlaying ? audio.pause() : audio.play();
    isPlaying = !isPlaying;
}

function playPauseAudio() {
    toggleAudio();
}

function rewindAudio() {
    audio.currentTime -= 5;
}

function forwardAudio() {
    audio.currentTime += 5;
}

function restartAudio() {
    audio.currentTime = 0;
    audio.play();
    isPlaying = true;
}

// æ‹–æ‹½åŠŸèƒ½
dragFunc('audio-player'); // åº”ç”¨æ‹–æ‹½åŠŸèƒ½åˆ°éŸ³ä¹æ’­æ”¾å™¨å›¾æ ‡å’ŒæŒ‰é’®

function dragFunc(id) {
    var Drag = document.getElementById(id);
    Drag.onmousedown = function(event) {
        var ev = event || window.event;
        event.stopPropagation();
        var disX = ev.clientX - Drag.offsetLeft;
        var disY = ev.clientY - Drag.offsetTop;
        document.onmousemove = function(event) {
            var ev = event || window.event;
            Drag.style.left = ev.clientX - disX + "px";
            Drag.style.top = ev.clientY - disY + "px";
            Drag.style.cursor = "move";
        };
    };
    Drag.onmouseup = function() {
        document.onmousemove = null;
        this.style.cursor = "default";
    };
};

// ä¸‹è½½éŸ³é¢‘
function downloadAudio() {
    const link = document.createElement('a');
    link.href = global_data.audio_filename;
    link.download = 'å¬åŠ›ææ–™.mp3';
    link.click();
}

// ä¸‹è½½PDF
function downloadPDF() {
    const link = document.createElement('a');
    link.href = global_data.pdf_filename;
    link.download = 'document.pdf';
    link.click();
}
</script>




<style>
body, html {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #f0f0f0;
    overflow: hidden; /* é˜²æ­¢æ‹–æ‹½æ—¶é¡µé¢æ»šåŠ¨ */
}

.container {
    text-align: center;
    transition: transform 0.5s ease-in-out;
    height: 100%; /* æˆ–è€…å…¶ä»–é€‚å½“çš„é«˜åº¦ */
    overflow: auto; /* å½“å†…å®¹æº¢å‡ºæ—¶ï¼Œæ·»åŠ æ»šåŠ¨æ¡ */
}

#content{
    justify-content: center; /* å­å…ƒç´ åœ¨ä¸»è½´(æ°´å¹³)ä¸Šå±…ä¸­å¯¹é½ */
    overflow: auto; /* å½“å†…å®¹æº¢å‡ºæ—¶ï¼Œæ·»åŠ æ»šåŠ¨æ¡ */
}

.header {
    margin-top: 300px;
    margin-bottom: 20px;
    width: 1000px;
}

.logo {
    width: 100px;
}

.tagline {
    font-size: 24px;
    color: #333;
}

.input-section {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
}

.input-box {
    padding: 10px;
    font-size: 18px;
    border: 2px solid #4CAF50;
    border-radius: 4px;
    width: 70%;
    box-sizing: border-box;
}

.confirm-button {
    margin-left: 10px;
    padding: 10px;
    font-size: 18px;
    color: white;
    background-color: #4CAF50;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.confirm-button:hover {
    background-color: #afcbf0;
}

.loading {
    margin-top: 20px;
    font-size: 18px;
    color: #555;
}

.content {
    margin-top: 20px;
}

#text-content  {
    color: #333;
    margin-left: 13%;
    width: 75%;
    text-align: left; /* å·¦å¯¹é½æ–‡æœ¬ */
    line-height: 1.0; /* è¡Œé«˜ */
}

#text-content p{
    color: #333;
    font-size: 20px;
    text-align: left; /* å·¦å¯¹é½æ–‡æœ¬ */
    line-height: 1.0; /* è¡Œé«˜ */
}
#text-content ul li{
    color: #333;
    font-size: 20px;
    text-align: left; /* å·¦å¯¹é½æ–‡æœ¬ */
    line-height: 1.0; /* è¡Œé«˜ */
}
.audio-icon {
    width: 24px;
    cursor: pointer;
    vertical-align: middle;
    margin-left: 10px;
}

.download-section {
    margin-top: 20px;
}

.download-section button {
    margin: 0 10px;
    padding: 10px;
    font-size: 16px;
    color: white;
    background-color: #4CAF50;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.download-section button:hover {
    background-color: #afcbf0;
}

/* styles.css */

.audio-player {
    position: absolute;
    bottom: 20px;
    left: 20px;
    padding: 10px;
    border: #4CAF50;
    border-radius: 4px;
    cursor: move;
    z-index: 1000;
    display: flex;
    flex-direction: column; /* å°†å­å…ƒç´ çºµå‘æ’åˆ— */
    align-items: center;
}

.icon-container {
    margin-bottom: 10px; /* æ§åˆ¶å›¾æ ‡ä¸æŒ‰é’®ä¹‹é—´çš„é—´è· */
}

.audio-icon {
    cursor: pointer;
    vertical-align: middle;
    width: 180px;
}

.button-container {
    display: flex;
    flex-direction: row; /* å°†æŒ‰é’®æ¨ªå‘æ’åˆ— */
}

.audio-player button {
    margin: 3px;
    padding: 5px;
    font-size: 30px;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.audio-player button:hover {
    background-color: #afcbf0;
}

svg {
    width: 3.75em;
    animation: 1.5s spin ease infinite;
  }
  
.ring {
    fill: none;
    stroke: hsla(197, 93%, 52%, 0.3);
    stroke-width: 2;
  }
  
.ball {
    fill: #4700ee;
    stroke: none;
  }
  
@keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
</style>